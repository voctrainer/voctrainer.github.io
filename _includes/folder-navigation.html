{% comment %}
–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –ø–∞–ø–∫—É
{% endcomment %}
{% assign current_path = page.url %}
{% assign path_parts = current_path | split: '/' %}
{% assign depth = path_parts | size | minus: 2 %}

{% comment %} –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å (–µ—Å–ª–∏ –Ω–µ –∫–æ—Ä–Ω–µ–≤–∞—è) {% endcomment %}
{% if depth > 0 %}
    {% assign parent_path = '' %}
    {% for i in (0..depth) %}
        {% assign part = path_parts[i] %}
        {% if part != '' %}
            {% assign parent_path = parent_path | append: '/' | append: part %}
        {% endif %}
    {% endfor %}
    <div class="parent-link">
        <a href="{{ parent_path | relative_url }}" style="
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #4051b5;
            text-decoration: none;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 8px 12px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        ">
            ‚§¥Ô∏è –ù–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ
        </a>
    </div>
{% endif %}

{% comment %} –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ {% endcomment %}
<h3 style="margin: 0 0 15px 0; color: #2c3e50;">
    {% if page.url == '/partitures/' %}
        üìÅ –í—Å–µ –ø–∞—Ä—Ç–∏—Ç—É—Ä—ã
    {% else %}
        üìÅ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
    {% endif %}
</h3>

{% comment %} –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ {% endcomment %}
{% assign folder_pages = site.pages | where: "nav", true | sort: "url" %}

{% comment %} –§–∏–ª—å—Ç—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ {% endcomment %}
<ul style="list-style: none; padding-left: 0; margin: 0;">
    {% for node in folder_pages %}
        {% if node.url contains current_path and node.url != current_path %}
            {% assign node_depth = node.url | split: '/' | size %}
            {% assign current_depth = current_path | split: '/' | size %}
            
            {% comment %} –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä—è–º—ã–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã {% endcomment %}
            {% if node_depth == current_depth | plus: 1 %}
                {% assign is_folder = false %}
                {% unless node.url contains '.html' %}
                    {% assign is_folder = true %}
                {% endunless %}
                
                <li style="margin-bottom: 8px;">
                    {% if is_folder %}
                        {% comment %} –≠—Ç–æ –ø–∞–ø–∫–∞ {% endcomment %}
                        {% assign folder_name = node.url | split: '/' | last %}
                        <a href="{{ node.url | relative_url }}" 
                           style="
                                color: #e67e22;
                                text-decoration: none;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                padding: 8px 12px;
                                background: white;
                                border-radius: 5px;
                                border: 1px solid #e9ecef;
                                font-weight: bold;
                                transition: all 0.2s;
                           "
                           onmouseover="this.style.backgroundColor='#fff3e0'; this.style.borderColor='#e67e22';"
                           onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e9ecef';">
                            üìÅ {{ folder_name | replace: '_', ' ' | capitalize }}
                        </a>
                    {% else %}
                        {% comment %} –≠—Ç–æ —Ñ–∞–π–ª {% endcomment %}
                        {% assign file_name = node.name | replace: '.md', '' | replace: '.html', '' %}
                        <a href="{{ node.url | relative_url }}" 
                           style="
                                color: #2c3e50;
                                text-decoration: none;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                padding: 8px 12px;
                                background: white;
                                border-radius: 5px;
                                border: 1px solid #e9ecef;
                                transition: all 0.2s;
                           "
                           onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.borderColor='#4051b5';"
                           onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e9ecef';">
                            üìÑ {{ file_name | replace: '_', ' ' | capitalize }}
                        </a>
                    {% endif %}
                </li>
            {% endif %}
        {% endif %}
    {% endfor %}
</ul>

{% comment %} –ï—Å–ª–∏ –ø–∞–ø–∫–∞ –ø—É—Å—Ç–∞—è {% endcomment %}
{% assign has_children = false %}
{% for node in folder_pages %}
    {% if node.url contains current_path and node.url != current_path %}
        {% assign node_depth = node.url | split: '/' | size %}
        {% assign current_depth = current_path | split: '/' | size %}
        {% if node_depth == current_depth | plus: 1 %}
            {% assign has_children = true %}
            {% break %}
        {% endif %}
    {% endif %}
{% endfor %}

{% unless has_children %}
    <div style="color: #7f8c8d; font-style: italic; padding: 20px; text-align: center;">
        –ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞
    </div>
{% endunless %}
