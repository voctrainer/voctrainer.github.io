{% comment %}
–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –ø–∞–ø–∫—É
{% endcomment %}
{% assign current_path = page.url %}
{% assign path_parts = current_path | split: '/' %}
{% assign depth = path_parts | size | minus: 2 %}

{% comment %} –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å (–µ—Å–ª–∏ –Ω–µ –∫–æ—Ä–Ω–µ–≤–∞—è) {% endcomment %}
{% if depth > 0 %}
    {% assign parent_path = '' %}
    {% for i in (0..depth) %}
        {% assign part = path_parts[i] %}
        {% if part != '' %}
            {% assign parent_path = parent_path | append: '/' | append: part %}
        {% endif %}
    {% endfor %}
    <div class="parent-link">
        <a href="{{ parent_path | relative_url }}" style="
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #4051b5;
            text-decoration: none;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 8px 12px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        ">
            ‚§¥Ô∏è –ù–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ
        </a>
    </div>
{% endif %}

{% comment %} –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ {% endcomment %}
<h3 style="margin: 0 0 15px 0; color: #2c3e50;">
    {% if page.url == '/partitures/' %}
        üìÅ –í—Å–µ –ø–∞—Ä—Ç–∏—Ç—É—Ä—ã
    {% else %}
        üìÅ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
    {% endif %}
</h3>

{% comment %} –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã {% endcomment %}
{% assign all_files = site.static_files %}
{% assign all_pages = site.pages %}

<ul style="list-style: none; padding-left: 0; margin: 0;">
    {% comment %} –°–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–∞–ø–∫–∏ (—Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è) {% endcomment %}
    {% for node in all_pages %}
        {% if node.url contains current_path and node.url != current_path %}
            {% assign node_depth = node.url | split: '/' | size %}
            {% assign current_depth = current_path | split: '/' | size %}
            
            {% comment %} –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä—è–º—ã–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã {% endcomment %}
            {% if node_depth == current_depth | plus: 1 %}
                {% assign is_folder = false %}
                {% unless node.url contains '.html' %}
                    {% assign is_folder = true %}
                {% endunless %}
                
                {% if is_folder %}
                    <li style="margin-bottom: 8px;">
                        {% assign folder_name = node.url | split: '/' | last %}
                        <a href="{{ node.url | relative_url }}" 
                           style="
                                color: #e67e22;
                                text-decoration: none;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                padding: 8px 12px;
                                background: white;
                                border-radius: 5px;
                                border: 1px solid #e9ecef;
                                font-weight: bold;
                                transition: all 0.2s;
                           "
                           onmouseover="this.style.backgroundColor='#fff3e0'; this.style.borderColor='#e67e22';"
                           onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e9ecef';">
                            üìÅ {{ folder_name | replace: '_', ' ' | capitalize }}
                        </a>
                    </li>
                {% endif %}
            {% endif %}
        {% endif %}
    {% endfor %}
    
    {% comment %} –ó–∞—Ç–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º) {% endcomment %}
    {% comment %} –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (.abc) {% endcomment %}
    {% for file in all_files %}
        {% if file.path contains current_path %}
            {% assign file_dir = file.path | remove: file.name %}
            {% assign file_dir_depth = file_dir | split: '/' | size %}
            {% assign current_dir_depth = current_path | split: '/' | size %}
            
            {% comment %} –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ {% endcomment %}
            {% if file_dir_depth == current_dir_depth %}
                {% if file.extname == '.abc' %}
                    <li style="margin-bottom: 8px;">
                        {% assign file_name = file.basename %}
                        {% assign html_file = file_name | append: '.html' %}
                        <a href="{{ current_path | relative_url }}{{ html_file }}" 
                           style="
                                color: #2c3e50;
                                text-decoration: none;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                padding: 8px 12px;
                                background: white;
                                border-radius: 5px;
                                border: 1px solid #e9ecef;
                                transition: all 0.2s;
                           "
                           onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.borderColor='#4051b5';"
                           onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e9ecef';">
                            üìÑ {{ file_name | replace: '_', ' ' | capitalize }}
                        </a>
                    </li>
                {% endif %}
            {% endif %}
        {% endif %}
    {% endfor %}
    
    {% comment %} HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã {% endcomment %}
    {% for node in all_pages %}
        {% if node.url contains current_path and node.url != current_path %}
            {% assign node_depth = node.url | split: '/' | size %}
            {% assign current_depth = current_path | split: '/' | size %}
            
            {% comment %} –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä—è–º—ã–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã {% endcomment %}
            {% if node_depth == current_depth | plus: 1 %}
                {% assign is_file = false %}
                {% if node.url contains '.html' %}
                    {% assign is_file = true %}
                {% endif %}
                
                {% if is_file %}
                    <li style="margin-bottom: 8px;">
                        {% assign file_name = node.basename %}
                        <a href="{{ node.url | relative_url }}" 
                           style="
                                color: #2c3e50;
                                text-decoration: none;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                padding: 8px 12px;
                                background: white;
                                border-radius: 5px;
                                border: 1px solid #e9ecef;
                                transition: all 0.2s;
                           "
                           onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.borderColor='#4051b5';"
                           onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#e9ecef';">
                            üìÑ {{ file_name | replace: '_', ' ' | capitalize }}
                        </a>
                    </li>
                {% endif %}
            {% endif %}
        {% endif %}
    {% endfor %}
</ul>

{% comment %} –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã {% endcomment %}
{% assign has_children = false %}

{% comment %} –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫–∏ {% endcomment %}
{% for node in all_pages %}
    {% if node.url contains current_path and node.url != current_path %}
        {% assign node_depth = node.url | split: '/' | size %}
        {% assign current_depth = current_path | split: '/' | size %}
        {% if node_depth == current_depth | plus: 1 %}
            {% assign has_children = true %}
        {% endif %}
    {% endif %}
{% endfor %}

{% comment %} –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã {% endcomment %}
{% unless has_children %}
    {% for file in all_files %}
        {% if file.path contains current_path %}
            {% assign file_dir = file.path | remove: file.name %}
            {% assign file_dir_depth = file_dir | split: '/' | size %}
            {% assign current_dir_depth = current_path | split: '/' | size %}
            {% if file_dir_depth == current_dir_depth and file.extname == '.abc' %}
                {% assign has_children = true %}
            {% endif %}
        {% endif %}
    {% endfor %}
{% endunless %}

{% unless has_children %}
    <div style="color: #7f8c8d; font-style: italic; padding: 20px; text-align: center;">
        –ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞
    </div>
{% endunless %}
