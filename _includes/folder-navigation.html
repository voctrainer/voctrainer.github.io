<div class="folder-navigation">
    <h3 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 16px;">
        üìÅ –ù–∞–≤–∏–≥–∞—Ü–∏—è
    </h3>
    
    <div id="tree-navigation">
        <div style="color: #7f8c8d; font-style: italic; padding: 20px; text-align: center;">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ä–µ–≤–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏...
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadTreeNavigation();
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
async function loadTreeNavigation() {
    try {
        const currentPath = window.location.pathname;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ
        const fullTreeResponse = await fetch('https://voctrainer.github.io/partitures/full-tree.json');
        if (!fullTreeResponse.ok) {
            throw new Error('Failed to load full tree');
        }
        const fullTree = await fullTreeResponse.json();
        
        // –°—Ç—Ä–æ–∏–º –¥–µ—Ä–µ–≤–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        renderTreeNavigation(fullTree, currentPath);
        
    } catch (error) {
        console.error('Error loading tree navigation:', error);
        document.getElementById('tree-navigation').innerHTML = 
            '<div style="color: #e74c3c; font-style: italic; padding: 20px; text-align: center; border: 1px solid #e74c3c; border-radius: 5px; background: #fdf2f2; font-size: 13px;">' +
            '‚ùå –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞' +
            '</div>';
    }
}

function renderTreeNavigation(tree, currentPath) {
    let html = '<div class="tree-view" style="font-size: 13px; line-height: 1.3;">';
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞
    function buildTree(items, level = 0, parentPath = '') {
        let treeHtml = '';
        
        items.forEach((item, index) => {
            const isLast = index === items.length - 1;
            const isFolder = item.type === 'folder';
            const isFile = item.type === 'file';
            const itemPath = item.path;
            const isCurrent = currentPath === itemPath;
            const hasChildren = isFolder && item.children && item.children.length > 0;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç—Å—Ç—É–ø—ã –∏ —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            let indentHtml = '';
            for (let i = 0; i < level; i++) {
                if (i === level - 1) {
                    indentHtml += isLast ? '<span style="display: inline-block; width: 16px;">‚îî‚îÄ</span>' : '<span style="display: inline-block; width: 16px;">‚îú‚îÄ</span>';
                } else {
                    indentHtml += '<span style="display: inline-block; width: 16px;">‚îÇ </span>';
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É
            let icon = 'üìÑ'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ñ–∞–π–ª–æ–≤
            if (isFolder) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞ –∏–ª–∏ –µ–µ –¥–æ—á–µ—Ä–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º–∏
                const isActiveFolder = currentPath.startsWith(itemPath + '/') || currentPath === itemPath;
                icon = isActiveFolder ? 'üìÇ' : 'üìÅ';
            }
            
            // –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            const activeStyle = isCurrent ? 'background-color: #4051b5!important; color: white!important; border-color: #4051b5!important;' : '';
            
            // –°—Ç—Ä–æ–∏–º —ç–ª–µ–º–µ–Ω—Ç –¥–µ—Ä–µ–≤–∞
            treeHtml += `
                <div style="display: flex; align-items: center; margin: 2px 0;">
                    <div style="font-family: monospace; color: #7f8c8d;">${indentHtml}</div>
                    <a href="${itemPath}${isFolder ? '/' : ''}" 
                       style="flex: 1; 
                              color: ${isFolder ? '#e67e22' : '#2c3e50'}; 
                              text-decoration: none; 
                              display: flex; 
                              align-items: center; 
                              gap: 6px; 
                              padding: 4px 8px; 
                              background: white; 
                              border-radius: 3px; 
                              border: 1px solid transparent;
                              transition: all 0.2s;
                              font-size: 13px;
                              font-weight: ${isFolder ? 'bold' : 'normal'};
                              ${activeStyle}"
                       onmouseover="this.style.backgroundColor='${isCurrent ? '#4051b5' : (isFolder ? '#fff3e0' : '#f8f9fa')}'; this.style.borderColor='${isFolder ? '#e67e22' : '#4051b5'};'"
                       onmouseout="this.style.backgroundColor='${isCurrent ? '#4051b5' : 'white'}'; this.style.borderColor='transparent';">
                        ${icon} ${item.displayName}
                    </a>
                </div>
            `;
            
            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–µ–π –¥–ª—è –ø–∞–ø–æ–∫
            if (isFolder && hasChildren) {
                treeHtml += buildTree(item.children, level + 1, itemPath);
            }
        });
        
        return treeHtml;
    }
    
    html += buildTree(tree);
    html += '</div>';
    
    document.getElementById('tree-navigation').innerHTML = html;
}

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –µ—Å–ª–∏ full-tree.json –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
async function loadAlternativeNavigation() {
    try {
        const currentPath = window.location.pathname;
        
        // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –∫ navigation.json
        const possiblePaths = [
            './navigation.json',
            '/partitures/navigation.json', 
            '/voctrainer.github.io/partitures/navigation.json',
            'navigation.json'
        ];
        
        let navData = null;
        
        for (const path of possiblePaths) {
            try {
                const response = await fetch(path);
                if (response.ok) {
                    navData = await response.json();
                    break;
                }
            } catch (error) {
                continue;
            }
        }
        
        if (navData) {
            renderSimpleNavigation(navData, currentPath);
        } else {
            throw new Error('No navigation data available');
        }
        
    } catch (error) {
        console.error('Error loading alternative navigation:', error);
        document.getElementById('tree-navigation').innerHTML = 
            '<div style="color: #e74c3c; font-style: italic; padding: 20px; text-align: center; border: 1px solid #e74c3c; border-radius: 5px; background: #fdf2f2; font-size: 13px;">' +
            '‚ùå –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞' +
            '</div>';
    }
}

function renderSimpleNavigation(navData, currentPath) {
    let html = '<div class="simple-tree" style="font-size: 13px; line-height: 1.3;">';
    
    // –ü–∞–ø–∫–∏
    if (navData.folders && navData.folders.length > 0) {
        navData.folders.forEach((folder, index) => {
            const isLast = index === navData.folders.length - 1 && (!navData.files || navData.files.length === 0);
            const isActive = currentPath.startsWith(folder.path);
            
            html += `
                <div style="display: flex; align-items: center; margin: 2px 0;">
                    <div style="font-family: monospace; color: #7f8c8d;">
                        ${isLast ? '‚îî‚îÄ' : '‚îú‚îÄ'}
                    </div>
                    <a href="${folder.path}${!folder.path.endsWith('/') ? '/' : ''}" 
                       style="flex: 1; 
                              color: #e67e22; 
                              text-decoration: none; 
                              display: flex; 
                              align-items: center; 
                              gap: 6px; 
                              padding: 4px 8px; 
                              background: white; 
                              border-radius: 3px; 
                              border: 1px solid transparent;
                              transition: all 0.2s;
                              font-size: 13px;
                              font-weight: bold;"
                       onmouseover="this.style.backgroundColor='#fff3e0'; this.style.borderColor='#e67e22';"
                       onmouseout="this.style.backgroundColor='white'; this.style.borderColor='transparent';">
                        ${isActive ? 'üìÇ' : 'üìÅ'} ${folder.displayName}
                    </a>
                </div>
            `;
        });
    }
    
    // –§–∞–π–ª—ã
    if (navData.files && navData.files.length > 0) {
        navData.files.forEach((file, index) => {
            const isLast = index === navData.files.length - 1;
            const isActive = currentPath === file.path;
            const activeStyle = isActive ? 'background-color: #4051b5!important; color: white!important; border-color: #4051b5!important;' : '';
            
            html += `
                <div style="display: flex; align-items: center; margin: 2px 0;">
                    <div style="font-family: monospace; color: #7f8c8d;">
                        ${isLast ? '‚îî‚îÄ' : '‚îú‚îÄ'}
                    </div>
                    <a href="${file.path}" 
                       style="flex: 1; 
                              color: #2c3e50; 
                              text-decoration: none; 
                              display: flex; 
                              align-items: center; 
                              gap: 6px; 
                              padding: 4px 8px; 
                              background: white; 
                              border-radius: 3px; 
                              border: 1px solid transparent;
                              transition: all 0.2s;
                              font-size: 13px;
                              ${activeStyle}"
                       onmouseover="this.style.backgroundColor='${isActive ? '#4051b5' : '#f8f9fa'}'; this.style.borderColor='#4051b5';"
                       onmouseout="this.style.backgroundColor='${isActive ? '#4051b5' : 'white'}'; this.style.borderColor='transparent';">
                        üìÑ ${file.displayName}
                    </a>
                </div>
            `;
        });
    }
    
    html += '</div>';
    document.getElementById('tree-navigation').innerHTML = html;
}

// –ï—Å–ª–∏ full-tree.json –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±
setTimeout(() => {
    const navElement = document.getElementById('tree-navigation');
    if (navElement && navElement.innerHTML.includes('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ä–µ–≤–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏')) {
        loadAlternativeNavigation();
    }
}, 1000);
</script>